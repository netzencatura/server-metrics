(()=>{"use strict";var t={246:(t,e,a)=>{a.d(e,{A:()=>r});const r={init:function(){console.log("Inicializace dark mode");var t="true"===localStorage.getItem("server_metrics_dark_mode");t?(jQuery("body").addClass("dark-mode"),jQuery("#dark-mode-toggle").text("Light Mode")):(jQuery("body").removeClass("dark-mode"),jQuery("#dark-mode-toggle").text("Dark Mode")),console.log("Dark mode nastaven:",t),jQuery("#dark-mode-toggle").on("click",this.toggle)},toggle:function(){console.log("Přepínání dark mode"),jQuery("body").toggleClass("dark-mode");var t=jQuery("body").hasClass("dark-mode");console.log("Nový stav dark mode:",t),localStorage.setItem("server_metrics_dark_mode",t),jQuery("#dark-mode-toggle").text(t?"Light Mode":"Dark Mode");var e=new CustomEvent("darkModeChanged",{detail:t});document.dispatchEvent(e)},isEnabled:function(){return jQuery("body").hasClass("dark-mode")}}}},e={};function a(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,a),n.exports}a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r=a(246);function i(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=Array(e);a<e;a++)r[a]=t[a];return r}const s={cpuChart:null,memoryChart:null,ioReadChart:null,ioWriteChart:null,avgCpuChart:null,avgRamChart:null,createChart:function(t,e,a,r,i,n,s){var o=document.getElementById(t).getContext("2d");return new Chart(o,{type:"line",data:{labels:e,datasets:[{label:r,data:a,backgroundColor:i,borderColor:i.replace("0.5","1"),borderWidth:1,fill:!0,tension:.4}]},options:{responsive:!0,animation:{duration:500,easing:"linear"},scales:{x:{display:!0,title:{display:!0,text:this.getTimeRangeLabel(),color:n},grid:{color:s},ticks:{color:n,maxRotation:45,minRotation:45,autoSkip:!0,maxTicksLimit:2,callback:function(t,e,a){return 0===e||e===a.length-1?this.getLabelForValue(t):""}}},y:{display:!0,title:{display:!0,text:r,color:n},beginAtZero:!0,grid:{color:s},ticks:{color:n}}},plugins:{legend:{labels:{color:n}},tooltip:{mode:"index",intersect:!1}}}})},addPointsToChart:function(t,e,a,r){if(t&&e&&a&&0!==e.length){for(var i=0;i<e.length;i++)t.data.labels.push(e[i]),t.data.datasets[0].data.push(a[i]),t.data.labels.length>r&&(t.data.labels.shift(),t.data.datasets[0].data.shift());t.update({duration:500,easing:"linear"})}},updateDetailCharts:function(t){if(t&&0!==t.length){t.reverse();var e=t.map((function(t){return new Date(t.timestamp).toLocaleString()})),a=t.map((function(t){return t.cpu_usage})),r=t.map((function(t){return t.mem_usage})),i=t.map((function(t){return t.io_read_rate})),n=t.map((function(t){return t.io_write_rate}));this.cpuChart&&this.cpuChart.destroy(),this.memoryChart&&this.memoryChart.destroy(),this.ioReadChart&&this.ioReadChart.destroy(),this.ioWriteChart&&this.ioWriteChart.destroy();var s=jQuery("body").hasClass("dark-mode"),o=s?"#e0e0e0":"#666",l=s?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";this.cpuChart=this.createChart("cpu-chart",e,a,serverMetricsData.strings.cpuUsage,"rgba(54, 162, 235, 0.5)",o,l),this.memoryChart=this.createChart("memory-chart",e,r,serverMetricsData.strings.memoryUsage,"rgba(255, 99, 132, 0.5)",o,l),this.ioReadChart=this.createChart("io-read-chart",e,i,serverMetricsData.strings.ioRead,"rgba(75, 192, 192, 0.5)",o,l),this.ioWriteChart=this.createChart("io-write-chart",e,n,serverMetricsData.strings.ioWrite,"rgba(153, 102, 255, 0.5)",o,l)}},drawAverageCharts:function(t){if(t.reverse(),this.avgCpuChart&&(this.avgCpuChart.destroy(),this.avgCpuChart=null),this.avgRamChart&&(this.avgRamChart.destroy(),this.avgRamChart=null),t&&0!==t.length){var e=t.map((function(t){return parseFloat(t.avg_cpu)})),a=t.map((function(t){return parseFloat(t.avg_mem)})),r=t.map((function(t){return new Date(t.hour_timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})),n=jQuery("body").hasClass("dark-mode"),s=n?"#64b5f6":"#0073aa",o=n?"rgba(100, 181, 246, 0.2)":"rgba(0, 115, 170, 0.1)",l=document.getElementById("avg-cpu-chart");if(l){var c=l.getContext("2d");this.avgCpuChart=new Chart(c,{type:"line",data:{labels:r,datasets:[{data:e,borderColor:s,backgroundColor:o,borderWidth:2,fill:!0,tension:.4,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{label:function(t){return t.raw.toFixed(1)+"%"}}}},scales:{x:{display:!1},y:{display:!1,suggestedMin:0,suggestedMax:1.2*Math.max.apply(Math,i(e).concat([1]))}},animation:{duration:500}}})}else console.error("Canvas element 'avg-cpu-chart' not found");var u=document.getElementById("avg-ram-chart");if(u){var d=u.getContext("2d");this.avgRamChart=new Chart(d,{type:"line",data:{labels:r,datasets:[{data:a,borderColor:s,backgroundColor:o,borderWidth:2,fill:!0,tension:.4,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,callbacks:{label:function(t){return t.raw.toFixed(1)+"%"}}}},scales:{x:{display:!1},y:{display:!1,suggestedMin:0,suggestedMax:1.2*Math.max.apply(Math,i(a).concat([1]))}},animation:{duration:500}}})}else console.error("Canvas element 'avg-ram-chart' not found")}else console.error("Žádná data pro průměrné grafy")},getTimeRangeLabel:function(){var t="";switch(jQuery("#period-filter").val()||"day"){case"30min":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.last30min+")";break;case"hour":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.lastHour+")";break;case"6hours":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.last6Hours+")";break;case"12hours":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.last12Hours+")";break;case"day":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.lastDay+")";break;case"week":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.lastWeek+")";break;case"month":t=serverMetricsData.strings.time+" ("+serverMetricsData.strings.lastMonth+")";break;default:t=serverMetricsData.strings.time}return t}};const o={loadWebsiteMetrics:function(t,e,a,r,i){jQuery.ajax({url:serverMetricsData.ajaxUrl,data:{action:"get_website_metrics",nonce:serverMetricsData.nonce,uuid:t,period:e,time_range:a||"15min"},dataType:"json",success:function(t){t.success?r(t.data):i(serverMetricsData.strings.failedToLoadData)},error:function(){i(serverMetricsData.strings.serverError)}})},loadLiveMetrics:function(t,e,a,r){jQuery.ajax({url:serverMetricsData.ajaxUrl,data:{action:"get_website_metrics_live",nonce:serverMetricsData.nonce,uuid:t,last_timestamp:e},dataType:"json",success:function(t){t.success&&t.data&&t.data.length>0?a(t.data):console.log("Žádná nová data pro aktualizaci",t)},error:function(t,e,a){console.error("Chyba při aktualizaci živých grafů:",a),r&&r(a)}})},loadSparklineData:function(t,e,a,r){jQuery.ajax({url:serverMetricsData.ajaxUrl,data:{action:"get_sparkline_data",nonce:serverMetricsData.nonce,uuid:t,period:e||"day"},dataType:"json",success:function(e){e.success&&e.data&&e.data.length>0?a(e.data):(console.warn("Žádná data pro sparkline ".concat(t,":"),e),r&&r(e))},error:function(e,a,i){console.error("Chyba při načítání dat pro sparkline ".concat(t,":"),i),r&&r(i)}})},loadAverageData:function(t,e,a){jQuery.ajax({url:serverMetricsData.ajaxUrl,data:{action:"get_average_historical_data",nonce:serverMetricsData.nonce,period:t},dataType:"json",success:function(t){t.success&&t.data&&t.data.length>0?e(t.data):(console.warn("Nelze načíst průměrná data:",t),a&&a(t))},error:function(t,e,r){console.error("Ajax chyba při načítání průměrných dat:",r),a&&a(r)}})}};var l={loadAll:function(t){console.log("Načítání sparkline grafů pro období:",t),jQuery(".sparkline").each((function(){try{var t=Chart.getChart(this);t&&t.destroy()}catch(t){}})),jQuery(".sparkline").each((function(){var e=this,a=jQuery(e).data("uuid"),r=jQuery(e).data("type");a&&r?(e.style.width="100%",e.style.height="100%",e.style.display="block",jQuery(e).parent(".sparkline-container").css({height:"30px",width:"100%",display:"block"}),o.loadSparklineData(a,t,(function(t){l.create(e,t,r)}),(function(t){console.warn("Chyba při načítání dat pro sparkline ".concat(a,":"),t)}))):console.warn("Chybí UUID nebo typ pro sparkline:",e)}))},create:function(t,e,a){e.reverse();var r=[],i="";switch(a){case"cpu":r=e.map((function(t){return parseFloat(t.cpu_usage)})),i="#36a2eb";break;case"memory":r=e.map((function(t){return parseFloat(t.mem_usage)})),i="#ff6384";break;case"io_read":r=e.map((function(t){return parseFloat(t.io_read_rate)})),i="#4bc0c0";break;case"io_write":r=e.map((function(t){return parseFloat(t.io_write_rate)})),i="#9966ff";break;default:return void console.warn("Neznámý typ grafu:",a)}if(0!==r.length)try{var n=t.getContext("2d");new Chart(n,{type:"line",data:{labels:Array(r.length).fill(""),datasets:[{data:r,borderColor:i,backgroundColor:i.replace("1)","0.1)"),borderWidth:2,fill:!1,tension:.4,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1,grid:{display:!1}},y:{display:!1,grid:{display:!1},min:0}},elements:{line:{tension:.4}},animation:{duration:0}}})}catch(t){console.error("Chyba při vytváření sparkline grafu:",t)}else console.warn("Žádné hodnoty pro typ:",a)}};const c=l;const u={safeToISOString:function(t){try{if("string"==typeof t&&t.includes(".")){var e=t.split(" ");if(e.length>=2){var a=e[0].split(".");if(a.length>=3){var r=parseInt(a[0].trim()),i=parseInt(a[1].trim())-1,n=parseInt(a[2].trim()),s=e[1].split(":"),o=parseInt(s[0]),l=parseInt(s[1]),c=parseInt(s[2]||"0");return new Date(n,i,r,o,l,c).toISOString()}}}return new Date(t).toISOString()}catch(e){return console.log("Chyba při převodu data:",t,e),null}},adjustLayoutForMobile:function(){window.innerWidth<768?jQuery(".detail-charts").css("grid-template-columns","1fr"):jQuery(".detail-charts").css("grid-template-columns","repeat(2, 1fr)")}};const d={liveUpdateInterval:null,currentUuid:null,maxPoints:15,currentTimeRange:"15min",lastTimestamps:{cpu:null,memory:null,ioRead:null,ioWrite:null},setupLiveCharts:function(t){var e=this;console.log("Nastavení živých grafů pro UUID:",t),this.currentUuid=t,this.liveUpdateInterval&&clearInterval(this.liveUpdateInterval),this.lastTimestamps={cpu:null,memory:null,ioRead:null,ioWrite:null},this.setupLiveUIElements(),o.loadWebsiteMetrics(t,jQuery("#period-filter").val(),this.currentTimeRange,(function(t){return s.updateDetailCharts(t)}),(function(t){return alert(t)})),this.liveUpdateInterval=setInterval((function(){e.updateLiveCharts()}),1e4)},stopLiveCharts:function(){console.log("Zastavení živých aktualizací"),this.liveUpdateInterval&&(clearInterval(this.liveUpdateInterval),this.liveUpdateInterval=null)},setupLiveUIElements:function(){if(jQuery(".live-indicator").length>0)return jQuery(".live-indicator").show(),void jQuery("#toggle-live-updates").text(serverMetricsData.strings.pauseUpdates).removeClass("paused");jQuery("#detail-domain").parent().is("h2")&&(jQuery("#detail-domain").wrap('<div class="modal-header"></div>'),jQuery(".modal-header").append('\n                <div class="modal-controls">\n                    <div class="live-indicator">\n                        <span class="live-dot"></span>\n                        <span class="live-text">'.concat(serverMetricsData.strings.liveUpdates,'</span>\n                    </div>\n                    <button id="toggle-live-updates" class="button">').concat(serverMetricsData.strings.pauseUpdates,"</button>\n                </div>\n            ")),jQuery(".close").prependTo(".modal-header"))},updateLiveCharts:function(){var t=this;if(console.log("Aktualizace živých grafů..."),this.currentUuid)try{var e=s.cpuChart&&s.cpuChart.data.labels.length?s.cpuChart.data.labels[s.cpuChart.data.labels.length-1]:null,a=s.memoryChart&&s.memoryChart.data.labels.length?s.memoryChart.data.labels[s.memoryChart.data.labels.length-1]:null,r=s.ioReadChart&&s.ioReadChart.data.labels.length?s.ioReadChart.data.labels[s.ioReadChart.data.labels.length-1]:null,i=s.ioWriteChart&&s.ioWriteChart.data.labels.length?s.ioWriteChart.data.labels[s.ioWriteChart.data.labels.length-1]:null;this.lastTimestamps.cpu=e?u.safeToISOString(e):null,this.lastTimestamps.memory=a?u.safeToISOString(a):null,this.lastTimestamps.ioRead=r?u.safeToISOString(r):null,this.lastTimestamps.ioWrite=i?u.safeToISOString(i):null;var n=[this.lastTimestamps.cpu,this.lastTimestamps.memory,this.lastTimestamps.ioRead,this.lastTimestamps.ioWrite].filter(Boolean),l=n.length?n.sort().pop():null;if(!l)return void o.loadWebsiteMetrics(this.currentUuid,jQuery("#period-filter").val(),this.currentTimeRange,(function(t){return s.updateDetailCharts(t)}),(function(t){return console.error("Chyba při načítání dat:",t)}));o.loadLiveMetrics(this.currentUuid,l,(function(e){return t.updateChartsWithNewData(e)}),(function(t){return console.error("Chyba při aktualizaci živých grafů:",t)}))}catch(t){console.error("Chyba při aktualizaci grafů:",t)}},updateChartsWithNewData:function(t){if(t&&0!==t.length){console.log("Aktualizace grafů s novými daty:",t.length,"bodů");var e=t.map((function(t){return new Date(t.timestamp).toLocaleString()})),a=t.map((function(t){return t.cpu_usage})),r=t.map((function(t){return t.mem_usage})),i=t.map((function(t){return t.io_read_rate})),n=t.map((function(t){return t.io_write_rate}));s.addPointsToChart(s.cpuChart,e,a,this.maxPoints),s.addPointsToChart(s.memoryChart,e,r,this.maxPoints),s.addPointsToChart(s.ioReadChart,e,i,this.maxPoints),s.addPointsToChart(s.ioWriteChart,e,n,this.maxPoints)}},setTimeRange:function(t){switch(this.currentTimeRange=t,t){case"30min":default:this.maxPoints=60;break;case"hour":this.maxPoints=120;break;case"6hours":case"12hours":case"month":this.maxPoints=360;break;case"day":this.maxPoints=288;break;case"week":this.maxPoints=336}},getCurrentUuid:function(){return this.currentUuid},getCurrentTimeRange:function(){return this.currentTimeRange}};jQuery(document).ready((function(t){if(console.log("Server Metrics Dashboard: Inicializace"),"undefined"==typeof Chart)return console.error("Chyba: Chart.js knihovna není načtena!"),void alert("Některé funkce nebudou fungovat správně - chybí knihovna Chart.js");function e(){o.loadAverageData(t("#period-filter").val(),(function(t){return s.drawAverageCharts(t)}),(function(t){return console.warn("Nelze načíst průměrná data:",t)}))}console.log("Spouštění inicializačních funkcí..."),r.A.init(),e(),setTimeout((function(){c.loadAll()}),300),u.adjustLayoutForMobile(),t(".show-detail-btn").on("click",(function(e){e.preventDefault();var a=t(this).data("uuid"),r=t(this).closest("tr").find("td:first").text();d.currentUuid=a,t("#detail-domain").text(serverMetricsData.strings.websiteDetail+": "+r),d.setupLiveCharts(a),t("#website-detail-modal").show()})),t(".close").on("click",(function(){t("#website-detail-modal").hide(),d.stopLiveCharts()})),t("#period-filter").on("change",(function(){d.stopLiveCharts();var a=t(this).val();d.getCurrentUuid()&&o.loadWebsiteMetrics(d.getCurrentUuid(),a,d.getCurrentTimeRange(),(function(t){return s.updateDetailCharts(t)}),(function(t){return alert(t)})),e(),c.loadAll(a),t("#website-detail-modal").is(":visible")&&d.setupLiveCharts(d.getCurrentUuid())})),t(document).on("click","#toggle-live-updates",(function(){var e=t(this);d.liveUpdateInterval?(d.stopLiveCharts(),e.text(serverMetricsData.strings.resumeUpdates).addClass("paused"),t(".live-indicator").hide()):(d.setupLiveCharts(d.getCurrentUuid()),e.text(serverMetricsData.strings.pauseUpdates).removeClass("paused"),t(".live-indicator").show())})),t(window).on("resize",(function(){u.adjustLayoutForMobile()})),document.addEventListener("darkModeChanged",(function(){setTimeout((function(){!function(){console.log("Obnovování všech grafů"),e(),d.getCurrentUuid()&&o.loadWebsiteMetrics(d.getCurrentUuid(),t("#period-filter").val(),d.getCurrentTimeRange(),(function(t){return s.updateDetailCharts(t)}),(function(t){return console.error("Chyba při načítání dat:",t)}));c.loadAll()}()}),300)}))}))})();